## ä½¿ç”¨å·¥å…·åŠè¯­è¨€

åˆçº¦ï¼šsolidity

åœ¨çº¿IDEï¼š[REMIX](https://remix.ethereum.org/#lang=en&optimize=false&runs=200&evmVersion=null&version=soljson-v0.8.26+commit.8a97fa7a.js)

æœ¬åœ°å¼€å‘å·¥å…·ï¼šTruffle

æœ¬åœ°ä»¥å¤ªåŠç¯å¢ƒï¼š [Ganache](https://archive.trufflesuite.com/ganache/)

<br/>

### REMIXä½¿ç”¨

Remix æ˜¯ä¸€ä¸ªç”¨äºç¼–å†™ã€ç¼–è¯‘ã€éƒ¨ç½²å’Œè°ƒè¯•ä»¥å¤ªåŠæ™ºèƒ½åˆçº¦çš„åœ¨çº¿é›†æˆå¼€å‘ç¯å¢ƒï¼ˆIDEï¼‰ã€‚æˆ‘ä»¬ä¸»è¦ç”¨åˆ°ç¼–å†™æ™ºèƒ½åˆçº¦ã€åˆçº¦ç¼–è¯‘ã€åˆçº¦éƒ¨ç½²å’Œè°ƒè¯•ã€‚è¿™äº›éƒ½æ˜¯æµ‹è¯•åˆçº¦æä¾›çš„åŠŸèƒ½ï¼Œæ— éœ€å’Œåç«¯ä»£ç äº¤äº’ã€‚

#### ä½¿ç”¨è¯´æ˜ï¼š

**åˆçº¦ç¼–å†™**

**FinancialTransaction.sol**

```soy_template
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.0;

import "@openzeppelin/contracts/access/Ownable.sol";
import "@openzeppelin/contracts/utils/ReentrancyGuard.sol";
import "@openzeppelin/contracts/utils/Strings.sol";

contract FinancialTransaction is Ownable, ReentrancyGuard {
    using Strings for uint256;
    
    enum Currency { USD, EUR }
    
    struct Transaction {
        string transactionId;
        string senderAccount;
        string receiverAccount;
        uint256 amount;
        Currency currency;
        uint256 timestamp;
        uint256 blockTimestamp;
        string note;
    }

    mapping(bytes32 => Transaction) private transactions;
    mapping(string => bytes32[]) private accountTransactions;
    mapping(address => bool) private authorizedUsers;

    event TransactionRecorded(
        bytes32 indexed hash,
        string transactionId,
        string senderAccount,
        string receiverAccount,
        uint256 amount,
        Currency currency,
        uint256 timestamp,
        uint256 blockTimestamp,
        string note
    );

    event TransactionNoteUpdated(bytes32 indexed hash, string note);
    event UserAuthorized(address user);
    event UserUnauthorized(address user);

    constructor() Ownable(msg.sender) {
        authorizedUsers[msg.sender] = true;
    }

    modifier onlyAuthorized() {
        require(authorizedUsers[msg.sender], "Not authorized");
        _;
    }

    function authorizeUser(address user) public onlyOwner {
        authorizedUsers[user] = true;
        emit UserAuthorized(user);
    }

    function unauthorizeUser(address user) public onlyOwner {
        authorizedUsers[user] = false;
        emit UserUnauthorized(user);
    }

    function recordTransaction(
        string memory _transactionId,
        string memory _senderAccount,
        string memory _receiverAccount,
        uint256 _amount,
        Currency _currency,
        uint256 _timestamp,
        string memory _note
    ) public onlyAuthorized nonReentrant returns (bytes32) {
        require(bytes(_transactionId).length > 0, "Transaction ID cannot be empty");
        require(bytes(_senderAccount).length > 0, "Sender account cannot be empty");
        require(bytes(_receiverAccount).length > 0, "Receiver account cannot be empty");
        require(_amount > 0, "Amount must be greater than 0");
        
        bytes32 transactionHash = keccak256(abi.encodePacked(_transactionId, _senderAccount, _receiverAccount, _amount, _currency, _timestamp, block.timestamp));
        
        require(transactions[transactionHash].timestamp == 0, "Transaction already exists");

        transactions[transactionHash] = Transaction({
            transactionId: _transactionId,
            senderAccount: _senderAccount,
            receiverAccount: _receiverAccount,
            amount: _amount,
            currency: _currency,
            timestamp: _timestamp,
            blockTimestamp: block.timestamp,
            note: _note
        });

        accountTransactions[_senderAccount].push(transactionHash);
        accountTransactions[_receiverAccount].push(transactionHash);

        emit TransactionRecorded(
            transactionHash,
            _transactionId,
            _senderAccount,
            _receiverAccount,
            _amount,
            _currency,
            _timestamp,
            block.timestamp,
            _note
        );

        return transactionHash;
    }

    function getTransactionByHash(bytes32 _transactionHash) public view onlyAuthorized returns (Transaction memory) {
        require(transactions[_transactionHash].timestamp != 0, "Transaction does not exist");
        return transactions[_transactionHash];
    }

    function getAccountTransactions(string memory _account) public view onlyAuthorized returns (bytes32[] memory) {
        return accountTransactions[_account];
    }

    function getCurrencyName(Currency _currency) public pure returns (string memory) {
        if (_currency == Currency.USD) {
            return "USD";
        } else if (_currency == Currency.EUR) {
            return "EUR";
        } else {
            revert("Invalid currency");
        }
    }

    function updateTransactionNote(bytes32 _transactionHash, string memory _note) public onlyAuthorized {
        require(transactions[_transactionHash].timestamp != 0, "Transaction does not exist");
        transactions[_transactionHash].note = _note;
        emit TransactionNoteUpdated(_transactionHash, _note);
    }

    function isAuthorized(address user) public view returns (bool) {
        return authorizedUsers[user];
    }
}
```

![æˆªå›¾](5856f46ca3079ea4ffa73b8f289cdeae.png)

1ã€æ‰“å¼€remixç½‘ç«™ï¼Œç‚¹å‡»ä¸Šå›¾çš„ç¬¬ä¸€æ­¥

2ã€ç‚¹å‡»ç¬¬äºŒæ­¥åˆ›å»ºæ–°æ–‡ä»¶ï¼Œæ–‡ä»¶åæœ€å¥½å’Œåˆçº¦åä¿æŒä¸€è‡´ï¼Œä¹Ÿå°±æ˜¯åˆçº¦é‡Œé¢çš„FinancialTransactionï¼Œå¦‚å›¾3ã€4

3ã€æŠŠåˆçº¦å¤åˆ¶åˆ°æ–‡ä»¶é‡Œï¼Œæˆ–è€…å¯ä»¥è‡ªå·±ç¼–å†™ã€‚è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯pragma solidity ^0.8.0;è¿™è¡Œï¼Œä»¥å¤ªåŠåˆçº¦ç¼–è¯‘å¯¹äºç‰ˆæœ¬è¦æ±‚æ˜¯å¼ºä¸€è‡´æ€§ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¼šç¼–è¯‘åˆçº¦é€‰æ‹©çš„envç‰ˆæœ¬è‡³å°‘å¤§äºç­‰äºç¼–å†™çš„åˆçº¦ç‰ˆæœ¬ã€‚

**åˆçº¦ç¼–è¯‘**

![æˆªå›¾](94e13539e527d66829965b2866c0f1e4.png)

1ã€å¦‚å›¾æ‰€ç¤ºé€‰æ‹©å·¦ä¾§ç¬¬ä¸‰ä¸ªå›¾æ ‡

2ã€è¿™é‡Œå¯ä»¥æŠŠAuto compileå‹¾é€‰ä¸Šï¼Œåé¢ä¿®æ”¹ä»£ç é€‰æ‹©ç¬¬ä¸‰ä¸ªå›¾æ ‡åä¼šè‡ªåŠ¨ç¼–è¯‘ï¼Œä¸ç”¨ç‚¹å‡»å›¾ä¸­ç¬¬4æ­¥äº†

3ã€é€‰æ‹©ç¼–è¯‘çš„ç‰ˆæœ¬ï¼Œè¿™é‡Œé€‰çš„ç‰ˆæœ¬éœ€è¦å¤§äºç­‰äºåˆçº¦å†…å®¹é‡Œé¢å®šä¹‰çš„pragma solidity ^0.8.0ç‰ˆæœ¬å·ï¼Œ^è¿™ä¸ªæ„æ€æ˜¯å‘ä¸Šå…¼å®¹

4ã€å¦‚æœæ²¡æœ‰å‹¾é€‰Auto compileï¼Œæ‰‹åŠ¨ç‚¹å‡»compileåˆçº¦ã€‚å¦‚æœåˆçº¦å†™çš„æœ‰é—®é¢˜ï¼Œåˆçº¦ä¼šæŠ¥çº¢ï¼Œå¹¶æœ‰æç¤º

<br/>

**åˆçº¦éƒ¨ç½²**

![æˆªå›¾](0dd76a3a7a6db1cb38fead996b672464.png)

1ã€é€‰æ‹©ç¬¬å››ä¸ªå›¾æ ‡

2ã€é€‰æ‹©éƒ¨ç½²çš„ä»¥å¤ªåŠç¯å¢ƒï¼Œè¿™é‡Œç›´æ¥ä½¿ç”¨Remix vmï¼Œæˆ‘ä»¬åªæ˜¯åšåˆçº¦æµ‹è¯•ï¼Œä¸éœ€è¦éƒ¨ç½²åˆ°æ­£å¼ç¯å¢ƒ

3ã€è¿™é‡Œæ˜¯åœ°å€åˆ—è¡¨ï¼Œå¯ä»¥é€‰æ‹©ä½¿ç”¨å“ªä¸ªä»¥å¤ªåŠè´¦æˆ·éƒ¨ç½²åˆçº¦ï¼Œéƒ¨ç½²åˆçº¦çš„è´¦æˆ·é»˜è®¤æœ‰åˆçº¦æ“ä½œçš„æƒé™ï¼Œå…¶ä»–ä»»ä½•åœ°å€éƒ½æ²¡æœ‰æ“ä½œåˆçº¦çš„æƒé™ï¼Œåé¢ä¼šè¯´æ€ä¹ˆæˆæƒå…¶ä»–è´¦æˆ·æ“ä½œæˆ‘ä»¬çš„æ™ºèƒ½åˆçº¦

4ã€è¿™ä¸€æ­¥æ˜¯è®¾ç½®gasè´¹ï¼Œåœ¨è¿™é‡Œç›´æ¥é€‰æ‹©Estimated Gasï¼Œè®©ä»–è‡ªå·±é¢„ä¼°

5ã€éƒ¨ç½²æ™ºèƒ½åˆçº¦ï¼Œå³ä¸‹è§’æ˜¾ç¤ºç»¿è‰²çš„å‹¾è¯´æ˜åˆçº¦éƒ¨ç½²æˆåŠŸï¼Œå¯ä»¥ç‚¹å‡»debugæŸ¥çœ‹å…·ä½“ä¿¡æ¯ã€‚å¦‚ä¸‹ï¼ŒåŒ…æ‹¬äº¤æ˜“hashï¼ŒåŒºå—å“ˆå¸Œï¼ŒåŒºå—ç¼–å·ã€åˆçº¦åœ°å€ç­‰ä¿¡æ¯ã€‚

![æˆªå›¾](029484637b18b6a9e7f2bd5d20e056f6.png)

**è°ƒç”¨åˆçº¦**

åˆçº¦éƒ¨ç½²å®Œç‚¹å‡»ä¸‹é¢å‰ªå¤´ï¼Œå±•å¼€è°ƒç”¨åˆçº¦çš„å„ç§æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯åˆçº¦é‡Œé¢å®šä¹‰çš„æ–¹æ³•æµ‹è¯•ï¼š

![æˆªå›¾](b017d140adf4ad8cd28aac6d2903ff6a.png)

æ–¹æ³•å¾ˆå¤šï¼Œå…·ä½“è¯´ä¸‹æˆæƒæ–¹æ³•å’Œäº¤æ˜“ã€æŸ¥è¯¢

1ã€æŸ¥è¯¢è´¦æˆ·æ˜¯å¦æœ‰è®¿é—®æƒé™ï¼Œåœ¨æŠŠè´¦æˆ·æ·»åŠ åˆ°æˆæƒé˜Ÿåˆ—ï¼Œå†æŸ¥è¯¢æ˜¯å¦æœ‰æƒé™ï¼Œåœ¨åˆçº¦éƒ¨ç½²é‚£å—æœ‰ä¸ªåœ°å€åˆ—è¡¨ï¼Œæˆ‘ä»¬é€‰æ‹©ç¬¬äºŒä¸ªåœ°å€å¤åˆ¶ä¸‹

![æˆªå›¾](f0c09b2bd04dd22190efc44f97ce72a0.png)

1ã€é€‰æ‹©åˆ—è¡¨çš„ç¬¬äºŒä¸ªåœ°å€ï¼Œç„¶åç‚¹å‡»ç¬¬äºŒæ­¥çš„å¤åˆ¶ï¼Œæ¯”å¦‚æˆ‘çš„ç¬¬äºŒä¸ªåœ°å€æ˜¯ï¼š0xAb8483F64d9C6d1EcF9b849Ae677dD3315835cb2

2ã€å¤åˆ¶å¥½äº†ï¼Œåœ¨åœ°å€åˆ—è¡¨å†åˆ‡æ¢åˆ°ç¬¬ä¸€ä¸ªåœ°å€ï¼Œå› ä¸ºæˆ‘ä»¬æ˜¯ç”¨ç¬¬ä¸€ä¸ªåœ°å€éƒ¨ç½²çš„åˆçº¦ï¼Œå…¶ä»–åœ°å€æ²¡æœ‰è°ƒç”¨åˆçº¦çš„æƒé™

![æˆªå›¾](88f9edb7e370967ca7ca00a9c16a20e6.png)

3ã€é€‰æ‹©isAuthorizedï¼Œè¾“å…¥åˆšæ‰å¤åˆ¶çš„ç¬¬äºŒä¸ªåœ°å€ï¼Œç‚¹å‡»callï¼Œä¼šçœ‹åˆ°è¿”å›falseï¼Œè¯´æ˜è¯¥åœ°å€æ²¡æœ‰æƒé™è°ƒç”¨åˆçº¦

![æˆªå›¾](e72581e8d17bb6b00f83af3b3cd17397.png)

4ã€æˆæƒè¯¥åœ°å€æ“ä½œæƒé™ï¼Œå¦‚å›¾1ã€2ã€3æ˜¯æˆæƒåœ°å€æƒé™ï¼Œ4ã€5ã€6ã€7æŸ¥è¯¢åˆšæ‰æˆæƒçš„åœ°å€æ˜¯å¦æœ‰æ“ä½œåˆçº¦çš„æƒé™

![æˆªå›¾](249c099bf2b4b6b54a0ee4a4a8578367.png)

5ã€ä½¿ç”¨åˆšæ‰æˆæƒçš„åœ°å€å¾€ä»¥å¤ªåŠçš„åˆçº¦å†™æ•°æ®ï¼Œéœ€è¦å…ˆæŠŠåœ°å€åˆ‡æ¢åˆ°åˆšæ‰æˆæƒçš„åœ°å€ï¼Œå¦‚å›¾æ‰€ç¤ºï¼Œå¡«å†™ç›¸å…³ä¿¡æ¯ï¼Œè¿™é‡Œçš„è´§å¸å•ä½æˆ‘ä½¿ç”¨çš„æ˜¯æšä¸¾ç±»å‹ï¼Œé»˜è®¤ä»0å¼€å§‹ï¼Œåé¢å¯ä»¥å†æ·»åŠ å…¶ä»–è´§å¸å•ä½ï¼Œç‚¹å‡»transactåå³è¾¹ä¼šæ˜¾ç¤ºäº¤æ˜“ä¿¡æ¯ï¼ŒåŒ…æ‹¬äº¤æ˜“hashã€å—ç¼–å·ä¹‹ç±»çš„ï¼Œè¿™é‡Œç‰¹åˆ«æ³¨æ„çš„æ˜¯outputï¼Œè¿™é‡Œè¾“å‡ºçš„æ˜¯æˆ‘ä»¬åœ¨åˆçº¦ä¸­å®šä¹‰çš„äº¤æ˜“idï¼Œåé¢å°±éœ€è¦ä½¿ç”¨è¿™ä¸ªäº¤æ˜“idå»é“¾ä¸ŠæŸ¥è¯¢äº¤æ˜“ä¿¡æ¯ã€‚

![æˆªå›¾](3c75ddd80f324151fd5b8bec99e58679.png)

6ã€æŸ¥è¯¢äº¤æ˜“ä¿¡æ¯ï¼Œå¦‚ä¸‹å›¾ï¼Œè¾“å…¥åˆšæ‰çš„outputï¼ŒæŸ¥è¯¢ä¼šæ˜¾ç¤ºæˆ‘ä»¬å†™å…¥ä»¥å¤ªåŠä¸Šçš„äº¤æ˜“ä¿¡æ¯

![æˆªå›¾](324737cb90606d746595c5bb1ced0b65.png)

<br/>

æˆ‘ä»¬èƒ½ç”¨åˆ°çš„RemixåŠŸèƒ½å°±è¿™äº›ï¼Œå…¶ä»–çš„æ— éœ€æ·±å…¥ç ”ç©¶ï¼ŒRemixåªæ˜¯è®©æˆ‘ä»¬æµ‹è¯•åˆçº¦ç¼–å†™æ˜¯å¦æ­£ç¡®ï¼Œåˆçº¦æä¾›çš„æ–¹æ³•æ˜¯å¦èƒ½æŒ‰é¢„æœŸè°ƒç”¨å’Œå›æ˜¾å°±å¯ä»¥äº†

<br/>

### Truffleä½¿ç”¨

Truffle æ˜¯ä¸€ä¸ªå¼€å‘æ¡†æ¶ï¼Œä¸“é—¨ç”¨äºä»¥å¤ªåŠæ™ºèƒ½åˆçº¦çš„å¼€å‘ã€æµ‹è¯•å’Œéƒ¨ç½²ï¼Œä¸»è¦åŒ…æ‹¬é¡¹ç›®ç»“æ„ç®¡ç†ã€ç¼–è¯‘å’Œéƒ¨ç½²åˆçº¦ã€ç½‘ç»œç®¡ç†ç­‰ï¼Œæˆ‘ä»¬è¿™ä¸ªé˜¶æ®µå¯èƒ½ç”¨åˆ°çš„å°±æ˜¯åˆçº¦ç¼–å†™ï¼Œåˆçº¦ç¼–è¯‘å’Œéƒ¨ç½²ï¼Œè¿™é‡Œçš„ç¼–è¯‘å’Œéƒ¨ç½²å°±æ˜¯éƒ¨ç½²åˆ°æœ¬åœ°çš„ä»¥å¤ªåŠç¯å¢ƒï¼Œå’Œremixä¸ä¸€æ ·ï¼Œremixéƒ¨ç½²æ˜¯éƒ¨ç½²åˆ°è™šæ‹Ÿçš„ç¯å¢ƒï¼Œå½“ç„¶remixä¹Ÿå¯ä»¥éƒ¨ç½²åˆ°å…¶ä»–ç¯å¢ƒã€‚

**å®‰è£…truffle**

æœ¬åœ°éœ€è¦éƒ¨ç½²nodeå’Œnpmï¼Œä¸”ç‰ˆæœ¬ä¸èƒ½è¿‡ä½ï¼Œå¯ä»¥å‚è€ƒæˆ‘æœ¬åœ°çš„ç‰ˆæœ¬ï¼Œæˆ‘æ˜¯åœ¨windowsä¸Šæµ‹è¯•çš„ï¼Œå…¶ä»–ç¯å¢ƒä¹Ÿå·®ä¸å¤š

![æˆªå›¾](7aab287a1126541f3261b4729e29a4b9.png)

å®‰è£…truffle

```sh
// å…¨å±€å®‰è£…truffle
npm install -g truffle
// åˆ›å»ºå¹¶åˆå§‹åŒ–é¡¹ç›®
mkdir dapp
cd dapp
truffle init
```

![æˆªå›¾](5f1d7c1c4aeee20452f23d902bbb0fac.png)

ä½¿ç”¨IDEæ‰“å¼€åˆšæ‰çš„DAPPç›®å½•ï¼Œæˆ‘ä½¿ç”¨çš„æ˜¯vs code:

![æˆªå›¾](a58ec36562d0c470b0ce33b4306da15e.png)

1ã€åœ¨contractsç›®å½•ä¸‹æ–°å»ºåˆçº¦æ–‡ä»¶ï¼ŒæŠŠåˆšæ‰çš„åˆçº¦å¤åˆ¶è¿›å»

2ã€åœ¨migrationsç›®å½•ä¸‹ç¼–å†™åˆçº¦éƒ¨ç½²è„šæœ¬ï¼Œå¦‚å›¾åå­—å°±å«2_deploy_contracts.jsï¼Œè¿™é‡Œå¯¹åå­—æœ‰ä¸€å®šè¦æ±‚ã€‚å†…å®¹å¦‚ä¸‹ï¼š

```jsx
const FinancialTransaction = artifacts.require("FinancialTransaction");

module.exports = function (deployer) {
  deployer.deploy(FinancialTransaction, { gas: 6721974 }); // è¿™é‡Œè®¾ç½®çš„gaséœ€è¦å°äºGanacheçš„Gasä¸Šé™ï¼Œä¸‹é¢ä¼šè¯´æ€ä¹ˆçœ‹ä¸Šé™
}; 
```

3ã€å¦‚æœåˆçº¦æŠ¥çº¢ï¼Œæ¯”å¦‚ä¸Šå›¾ä¸Šçš„å¯¼å…¥çš„ä¾èµ–æŠ¥é”™ï¼Œè¯´æ˜æœ¬åœ°æ²¡æœ‰è¿™äº›ä¾èµ–ï¼Œéœ€è¦ä½¿ç”¨npmå®‰è£…ä¾èµ–

```
// åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤
npm install @openzeppelin/contracts
```

![æˆªå›¾](5470427f7fcb3d3f7951db370229c279.png)

<br/>

åˆ°è¿™é‡ŒTruffleä½¿ç”¨å°±å…ˆåˆ°è¿™ï¼Œå› ä¸ºåé¢æ¶‰åŠåˆ°åˆçº¦éƒ¨ç½²ï¼Œæœ¬åœ°éœ€è¦å®‰è£…Ganacheï¼Œç„¶åä½¿ç”¨Truffleå‘½ä»¤å®Œæˆåˆçº¦çš„ç¼–è¯‘å’Œéƒ¨ç½²

### Ganacheå®‰è£…

ä¸‹è½½åœ°å€ï¼š[https://archive.trufflesuite.com/ganache/](https://archive.trufflesuite.com/ganache/)

å®‰è£…åï¼Œç›´æ¥æ‰“å¼€Ganacheï¼Œå¦‚ä¸‹å›¾é€‰æ‹©Quickstartï¼Œä½¿ç”¨æ–°çš„å¾—ç¯å¢ƒï¼Œå¦‚1ï¼Œæˆ–è€…åé¢ä½ ä¿å­˜çš„ç¯å¢ƒå¯ä»¥é€‰æ‹©ä¿å­˜çš„ç¯å¢ƒï¼Œå¦‚å›¾2

![æˆªå›¾](cfa75544b90d0b70f200f22eff3957be.png)

è¿™é‡Œé»˜è®¤ä¼šç»™ä½ æ˜¯ä¸ªè´¦æˆ·ï¼Œå¹¶ä¸”æ¯ä¸ªè´¦æˆ·éƒ½æœ‰100ETHï¼Œä¸€ä¼šæˆ‘ä»¬éƒ¨ç½²çš„æ—¶å€™é»˜è®¤ä½¿ç”¨çš„æ˜¯ç¬¬ä¸€ä¸ªè´¦æˆ·åœ°å€

![æˆªå›¾](ef63d262b1159ec123b310ca323fdcb3.png)

è®¾ç½®ä»¥å¤ªåŠç¯å¢ƒï¼ŒåŒ…æ‹¬ç«¯å£å·ã€ç¼–è¯‘å™¨ç‰ˆæœ¬ã€ç½‘ç»œIDç­‰ä¿¡æ¯ï¼Œç‚¹å‡»è®¾ç½®ï¼Œå¦‚å›¾

![æˆªå›¾](6fdd817e0e66dd54d2c17c4ed81c73fc.png)

å¦‚å›¾æ‰€ç¤ºï¼Œå¯ä»¥è®¾ç½®ç«¯å£å’Œç½‘ç»œIDï¼Œè¿™é‡Œè‡ªåŠ¨æŒ–çŸ¿å‹¾é€‰ä¸Šï¼Œä¸ç„¶æ¯æ¬¡å‘èµ·äº¤æ˜“éƒ½æ— æ³•æ‰“åŒ…ä¸Šé“¾ï¼Œéœ€è¦æ‰‹åŠ¨æŒ–çŸ¿äº§å‡ºå—æ‰å¯ä»¥

![æˆªå›¾](8e22a869834cb7ce2314d047c81b424f.png)

<br/>

è¿™é‡Œè®¾ç½®Gasè´¹çš„ä¸Šçº¿ï¼Œåé¢çš„å®¢æˆ·ç«¯ä»£ç è°ƒç”¨åˆçº¦è®¾ç½®çš„gasè´¹ä¸èƒ½è¶…è¿‡è¿™ä¸ªé˜ˆå€¼ï¼ŒåŒæ—¶hardforké€‰æ‹©Londonï¼Œè¿™ä¸ªå’Œåˆçº¦ç¼–è¯‘ç‰ˆæœ¬æœ‰å…³ï¼Œç»æµ‹è¯•é»˜è®¤çš„æ— æ³•ç¼–è¯‘

![æˆªå›¾](96972a60f00fafacf786f8e58eec77cc.png)

ä¸€åˆ‡éƒ½è®¾ç½®å¥½ä¹‹åï¼Œç‚¹å‡»å³ä¸Šè§’çš„save and restartï¼Œé‡å¯ä»¥å¤ªç½‘ç»œã€‚å›åˆ°é¦–é¡µçš„æ—¶å€™ï¼Œæœ€å¥½ç‚¹å‡»ä¿å­˜ï¼Œå¦‚ä¸‹å›¾ï¼Œè¿™æ ·ä¸‹æ¬¡åœ¨å¯åŠ¨Ganacheçš„æ—¶å€™å¯ä»¥é€‰æ‹©ä¿å­˜çš„workspaceï¼Œä¸ç”¨å†é‡å¤´å¼€å§‹å¼„

![æˆªå›¾](d9c631123ad5ac34d4458f0428253a3b.png)

<br/>

åˆ°è¿™é‡Œï¼ŒGanacheçš„è®¾ç½®å°±å¼„å¥½äº†ï¼Œä¸‹é¢é…ç½®Truffleï¼Œå›åˆ°åˆšæ‰çš„daapé¡¹ç›®ä¸‹é¢æœ‰ä¸ªtruffle-config.jsé…ç½®æ–‡ä»¶

è¿™é‡Œæœ‰å‡ ä¸ªåœ°æ–¹éœ€è¦ä¿®æ”¹ä¸‹

1ã€networké…ç½®æ”¾å¼€ï¼Œä¿®æ”¹å¦‚ä¸‹ï¼š

```
 networks: {
    // Useful for testing. The `development` name is special - truffle uses it by default
    // if it's defined here and no other network is specified at the command line.
    // You should run a client (like ganache, geth, or parity) in a separate terminal
    // tab if you use this network and you must also set the `host`, `port` and `network_id`
    // options below to some value.
    //
    development: {
     host: "127.0.0.1",     // Localhost (default: none)
     port: 7545,            // Standard Ethereum port (default: none)
     network_id: "5777",       // Any network (default: none)
    },
```

2ã€compilersä¿®æ”¹å¦‚ä¸‹ï¼š

```
compilers: {
    solc: {
      version: "0.8.26",      // Fetch exact version from solc-bin (default: truffle's version),éœ€è¦å¤§äºç­‰äºç¼–å†™åˆçº¦æ—¶è®¾ç½®çš„å€¼
      // docker: true,        // Use "0.5.1" you've installed locally with docker (default: false)
      settings: {          // See the solidity docs for advice about optimization and evmVersion
      //  optimizer: {
      //    enabled: false,
      //    runs: 200
      //  },
       evmVersion: "london"      // å’ŒGanacheé€‰çš„hardforkä¿æŒä¸€è‡´
      }
    }
  },
```

å…¨éƒ¨é…ç½®å¦‚ä¸‹ï¼š

```
/**
 * Use this file to configure your truffle project. It's seeded with some
 * common settings for different networks and features like migrations,
 * compilation, and testing. Uncomment the ones you need or modify
 * them to suit your project as necessary.
 *
 * More information about configuration can be found at:
 *
 * https://trufflesuite.com/docs/truffle/reference/configuration
 *
 * Hands-off deployment with Infura
 * --------------------------------
 *
 * Do you have a complex application that requires lots of transactions to deploy?
 * Use this approach to make deployment a breeze ğŸ–ï¸:
 *
 * Infura deployment needs a wallet provider (like @truffle/hdwallet-provider)
 * to sign transactions before they're sent to a remote public node.
 * Infura accounts are available for free at ğŸ”: https://infura.io/register
 *
 * You'll need a mnemonic - the twelve word phrase the wallet uses to generate
 * public/private key pairs. You can store your secrets ğŸ¤ in a .env file.
 * In your project root, run `$ npm install dotenv`.
 * Create .env (which should be .gitignored) and declare your MNEMONIC
 * and Infura PROJECT_ID variables inside.
 * For example, your .env file will have the following structure:
 *
 * MNEMONIC = <Your 12 phrase mnemonic>
 * PROJECT_ID = <Your Infura project id>
 *
 * Deployment with Truffle Dashboard (Recommended for best security practice)
 * --------------------------------------------------------------------------
 *
 * Are you concerned about security and minimizing rekt status ğŸ¤”?
 * Use this method for best security:
 *
 * Truffle Dashboard lets you review transactions in detail, and leverages
 * MetaMask for signing, so there's no need to copy-paste your mnemonic.
 * More details can be found at ğŸ”:
 *
 * https://trufflesuite.com/docs/truffle/getting-started/using-the-truffle-dashboard/
 */

// require('dotenv').config();
// const { MNEMONIC, PROJECT_ID } = process.env;

// const HDWalletProvider = require('@truffle/hdwallet-provider');

module.exports = {
  /**
   * Networks define how you connect to your ethereum client and let you set the
   * defaults web3 uses to send transactions. If you don't specify one truffle
   * will spin up a managed Ganache instance for you on port 9545 when you
   * run `develop` or `test`. You can ask a truffle command to use a specific
   * network from the command line, e.g
   *
   * $ truffle test --network <network-name>
   */

  networks: {
    // Useful for testing. The `development` name is special - truffle uses it by default
    // if it's defined here and no other network is specified at the command line.
    // You should run a client (like ganache, geth, or parity) in a separate terminal
    // tab if you use this network and you must also set the `host`, `port` and `network_id`
    // options below to some value.
    //
    development: {
     host: "127.0.0.1",     // Localhost (default: none)
     port: 7545,            // Standard Ethereum port (default: none)
     network_id: "5777",       // Any network (default: none)
    },
    //
    // An additional network, but with some advanced optionsâ€¦
    // advanced: {
    //   port: 8777,             // Custom port
    //   network_id: 1342,       // Custom network
    //   gas: 8500000,           // Gas sent with each transaction (default: ~6700000)
    //   gasPrice: 20000000000,  // 20 gwei (in wei) (default: 100 gwei)
    //   from: <address>,        // Account to send transactions from (default: accounts[0])
    //   websocket: true         // Enable EventEmitter interface for web3 (default: false)
    // },
    //
    // Useful for deploying to a public network.
    // Note: It's important to wrap the provider as a function to ensure truffle uses a new provider every time.
    // goerli: {
    //   provider: () => new HDWalletProvider(MNEMONIC, `https://goerli.infura.io/v3/${PROJECT_ID}`),
    //   network_id: 5,       // Goerli's id
    //   confirmations: 2,    // # of confirmations to wait between deployments. (default: 0)
    //   timeoutBlocks: 200,  // # of blocks before a deployment times out  (minimum/default: 50)
    //   skipDryRun: true     // Skip dry run before migrations? (default: false for public nets )
    // },
    //
    // Useful for private networks
    // private: {
    //   provider: () => new HDWalletProvider(MNEMONIC, `https://network.io`),
    //   network_id: 2111,   // This network is yours, in the cloud.
    //   production: true    // Treats this network as if it was a public net. (default: false)
    // }
  },

  // Set default mocha options here, use special reporters, etc.
  mocha: {
    // timeout: 100000
  },

  // Configure your compilers
  compilers: {
    solc: {
      version: "0.8.26",      // Fetch exact version from solc-bin (default: truffle's version)
      // docker: true,        // Use "0.5.1" you've installed locally with docker (default: false)
      settings: {          // See the solidity docs for advice about optimization and evmVersion
      //  optimizer: {
      //    enabled: false,
      //    runs: 200
      //  },
       evmVersion: "london"
      }
    }
  },

  // Truffle DB is currently disabled by default; to enable it, change enabled:
  // false to enabled: true. The default storage location can also be
  // overridden by specifying the adapter settings, as shown in the commented code below.
  //
  // NOTE: It is not possible to migrate your contracts to truffle DB and you should
  // make a backup of your artifacts to a safe location before enabling this feature.
  //
  // After you backed up your artifacts you can utilize db by running migrate as follows:
  // $ truffle migrate --reset --compile-all
  //
  // db: {
  //   enabled: false,
  //   host: "127.0.0.1",
  //   adapter: {
  //     name: "indexeddb",
  //     settings: {
  //       directory: ".db"
  //     }
  //   }
  // }
};

```

<br/>

**åˆçº¦ç¼–è¯‘**

æ‰§è¡Œtruffle compileï¼Œé¡¹ç›®ä¼šå¤šä¸ªbuildç›®å½•ï¼Œä¸‹é¢éƒ½æ˜¯åˆçº¦çš„abiæ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶åœ¨åç«¯ä»£ç è°ƒç”¨åˆçº¦çš„æ—¶å€™éœ€è¦ç”¨åˆ°ã€‚

![æˆªå›¾](60e998f59934a1f221f328a41b8fe07e.png)

é™¤äº†ä¸Šé¢è¯´çš„é€šè¿‡truffle compileç¼–è¯‘è·å–abiæ–‡ä»¶å¤–ï¼Œä¹Ÿå¯ä»¥é€šè¿‡Remixè·å–ï¼Œå› ä¸ºæœ‰çš„åæ®µä»£ç ä¸éœ€è¦abiåŒ…å«networkä¿¡æ¯ï¼Œè¿™ä¸ªæ—¶å€™å¯ä»¥åˆ°remixè·å–abiæ–‡ä»¶ã€‚æ­¥éª¤å¦‚ä¸‹ï¼šç‚¹å‡»åˆçº¦ç¼–è¯‘ï¼Œåœ¨ç‚¹å‡»abiç›´æ¥å¤åˆ¶ã€‚

![æˆªå›¾](5c4bddf276330d25aa9433f48a0d9986.png)

abiæ–‡ä»¶æ˜¯ä¸ªjsonæ–‡ä»¶ï¼Œå¤§è‡´å†…å®¹å¦‚ä¸‹ï¼š

FinancialTransaction.json

```json
[
  {
    "inputs": [],
    "stateMutability": "nonpayable",
    "type": "constructor"
  },
  {
    "inputs": [
      {
        "internalType": "address",
        "name": "owner",
        "type": "address"
      }
    ],
    "name": "OwnableInvalidOwner",
    "type": "error"
  },
  {
    "inputs": [
      {
        "internalType": "address",
        "name": "account",
        "type": "address"
      }
    ],
    "name": "OwnableUnauthorizedAccount",
    "type": "error"
  },
  {
    "inputs": [],
    "name": "ReentrancyGuardReentrantCall",
    "type": "error"
  },
  {
    "anonymous": false,
    "inputs": [
      {
        "indexed": true,
        "internalType": "address",
        "name": "previousOwner",
        "type": "address"
      },
      {
        "indexed": true,
        "internalType": "address",
        "name": "newOwner",
        "type": "address"
      }
    ],
    "name": "OwnershipTransferred",
    "type": "event"
  },
  {
    "anonymous": false,
    "inputs": [
      {
        "indexed": true,
        "internalType": "bytes32",
        "name": "hash",
        "type": "bytes32"
      },
      {
        "indexed": false,
        "internalType": "string",
        "name": "note",
        "type": "string"
      }
    ],
    "name": "TransactionNoteUpdated",
    "type": "event"
  },
  {
    "anonymous": false,
    "inputs": [
      {
        "indexed": true,
        "internalType": "bytes32",
        "name": "hash",
        "type": "bytes32"
      },
      {
        "indexed": false,
        "internalType": "string",
        "name": "transactionId",
        "type": "string"
      },
      {
        "indexed": false,
        "internalType": "string",
        "name": "senderAccount",
        "type": "string"
      },
      {
        "indexed": false,
        "internalType": "string",
        "name": "receiverAccount",
        "type": "string"
      },
      {
        "indexed": false,
        "internalType": "uint256",
        "name": "amount",
        "type": "uint256"
      },
      {
        "indexed": false,
        "internalType": "enum FinancialTransaction.Currency",
        "name": "currency",
        "type": "uint8"
      },
      {
        "indexed": false,
        "internalType": "uint256",
        "name": "timestamp",
        "type": "uint256"
      },
      {
        "indexed": false,
        "internalType": "uint256",
        "name": "blockTimestamp",
        "type": "uint256"
      },
      {
        "indexed": false,
        "internalType": "string",
        "name": "note",
        "type": "string"
      }
    ],
    "name": "TransactionRecorded",
    "type": "event"
  },
  {
    "anonymous": false,
    "inputs": [
      {
        "indexed": false,
        "internalType": "address",
        "name": "user",
        "type": "address"
      }
    ],
    "name": "UserAuthorized",
    "type": "event"
  },
  {
    "anonymous": false,
    "inputs": [
      {
        "indexed": false,
        "internalType": "address",
        "name": "user",
        "type": "address"
      }
    ],
    "name": "UserUnauthorized",
    "type": "event"
  },
  {
    "inputs": [
      {
        "internalType": "address",
        "name": "user",
        "type": "address"
      }
    ],
    "name": "authorizeUser",
    "outputs": [],
    "stateMutability": "nonpayable",
    "type": "function"
  },
  {
    "inputs": [
      {
        "internalType": "string",
        "name": "_account",
        "type": "string"
      }
    ],
    "name": "getAccountTransactions",
    "outputs": [
      {
        "internalType": "bytes32[]",
        "name": "",
        "type": "bytes32[]"
      }
    ],
    "stateMutability": "view",
    "type": "function"
  },
  {
    "inputs": [
      {
        "internalType": "enum FinancialTransaction.Currency",
        "name": "_currency",
        "type": "uint8"
      }
    ],
    "name": "getCurrencyName",
    "outputs": [
      {
        "internalType": "string",
        "name": "",
        "type": "string"
      }
    ],
    "stateMutability": "pure",
    "type": "function"
  },
  {
    "inputs": [
      {
        "internalType": "bytes32",
        "name": "_transactionHash",
        "type": "bytes32"
      }
    ],
    "name": "getTransactionByHash",
    "outputs": [
      {
        "components": [
          {
            "internalType": "string",
            "name": "transactionId",
            "type": "string"
          },
          {
            "internalType": "string",
            "name": "senderAccount",
            "type": "string"
          },
          {
            "internalType": "string",
            "name": "receiverAccount",
            "type": "string"
          },
          {
            "internalType": "uint256",
            "name": "amount",
            "type": "uint256"
          },
          {
            "internalType": "enum FinancialTransaction.Currency",
            "name": "currency",
            "type": "uint8"
          },
          {
            "internalType": "uint256",
            "name": "timestamp",
            "type": "uint256"
          },
          {
            "internalType": "uint256",
            "name": "blockTimestamp",
            "type": "uint256"
          },
          {
            "internalType": "string",
            "name": "note",
            "type": "string"
          }
        ],
        "internalType": "struct FinancialTransaction.Transaction",
        "name": "",
        "type": "tuple"
      }
    ],
    "stateMutability": "view",
    "type": "function"
  },
  {
    "inputs": [
      {
        "internalType": "address",
        "name": "user",
        "type": "address"
      }
    ],
    "name": "isAuthorized",
    "outputs": [
      {
        "internalType": "bool",
        "name": "",
        "type": "bool"
      }
    ],
    "stateMutability": "view",
    "type": "function"
  },
  {
    "inputs": [],
    "name": "owner",
    "outputs": [
      {
        "internalType": "address",
        "name": "",
        "type": "address"
      }
    ],
    "stateMutability": "view",
    "type": "function"
  },
  {
    "inputs": [
      {
        "internalType": "string",
        "name": "_transactionId",
        "type": "string"
      },
      {
        "internalType": "string",
        "name": "_senderAccount",
        "type": "string"
      },
      {
        "internalType": "string",
        "name": "_receiverAccount",
        "type": "string"
      },
      {
        "internalType": "uint256",
        "name": "_amount",
        "type": "uint256"
      },
      {
        "internalType": "enum FinancialTransaction.Currency",
        "name": "_currency",
        "type": "uint8"
      },
      {
        "internalType": "uint256",
        "name": "_timestamp",
        "type": "uint256"
      },
      {
        "internalType": "string",
        "name": "_note",
        "type": "string"
      }
    ],
    "name": "recordTransaction",
    "outputs": [
      {
        "internalType": "bytes32",
        "name": "",
        "type": "bytes32"
      }
    ],
    "stateMutability": "nonpayable",
    "type": "function"
  },
  {
    "inputs": [],
    "name": "renounceOwnership",
    "outputs": [],
    "stateMutability": "nonpayable",
    "type": "function"
  },
  {
    "inputs": [
      {
        "internalType": "address",
        "name": "newOwner",
        "type": "address"
      }
    ],
    "name": "transferOwnership",
    "outputs": [],
    "stateMutability": "nonpayable",
    "type": "function"
  },
  {
    "inputs": [
      {
        "internalType": "address",
        "name": "user",
        "type": "address"
      }
    ],
    "name": "unauthorizeUser",
    "outputs": [],
    "stateMutability": "nonpayable",
    "type": "function"
  },
  {
    "inputs": [
      {
        "internalType": "bytes32",
        "name": "_transactionHash",
        "type": "bytes32"
      },
      {
        "internalType": "string",
        "name": "_note",
        "type": "string"
      }
    ],
    "name": "updateTransactionNote",
    "outputs": [],
    "stateMutability": "nonpayable",
    "type": "function"
  }
]
```

**åˆçº¦éƒ¨ç½²**

æ‰§è¡Œå‘½ä»¤ truffle deployï¼Œå¦‚ä¸‹å›¾ï¼Œä¼šåœ¨Ganacheéƒ¨ç½²æˆ‘ä»¬çš„åˆçº¦ï¼Œå…¶ä¸­æœ‰å‡ ä¸ªåœ°æ–¹éœ€è¦æ³¨æ„ï¼Œåœ¨åé¢çš„åç«¯ä»£ç æ“ä½œåˆçº¦çš„æ—¶å€™éœ€è¦ç”¨åˆ°ã€‚

1ã€contract addressï¼šåˆçº¦åœ°å€éœ€è¦è®°ä½ï¼Œä»£ç å¼€å‘çš„æ—¶å€™éœ€è¦ç”¨åˆ°

2ã€accountï¼šéƒ¨ç½²åˆçº¦çš„è´¦æˆ·éœ€è¦è®°ä½ï¼Œä»£ç å¼€å‘çš„æ—¶å€™éœ€è¦æŒ‡å®šå¯åŠ¨è´¦æˆ·ï¼Œè¿™ä¸ªæ—¶å€™éœ€è¦æŒ‡å®šéƒ¨ç½²åˆçº¦çš„è´¦æˆ·ï¼Œå…¶ä»–è´¦æˆ·æ²¡æœ‰æ“ä½œåˆçº¦çš„æƒé™ã€‚

![æˆªå›¾](7c8c6f9a5ca9899c3f41f6d8d6edb064.png)

<br/>

æ‰“å¼€Ganacheï¼Œè·å–éƒ¨ç½²åˆçº¦çš„è´¦æˆ·çš„ç§é’¥ï¼Œä»£ç å¼€å‘çš„æ—¶å€™éœ€è¦ç”¨åˆ°ï¼Œè¿™ä¸ªè‡³å°‘çŸ¥é“åœ¨å“ªé‡Œè·å–ï¼Œå¦‚ä¸‹å›¾ï¼Œç‚¹å‡»ç¬¬ä¸€ä¸ªè´¦æˆ·ï¼ˆåˆšæ‰éƒ¨ç½²åˆçº¦æ—¶çš„accountè´¦æˆ·ï¼‰å³è¾¹çš„å°é’¥åŒ™å›¾æ ‡ï¼š

![æˆªå›¾](81cfc600026b527c4d1e958a1804c0f8.png)

![æˆªå›¾](76b2b6a3198b61340ef43f7bac32be83.png)

<br/>

åŒæ ·æˆ‘ä»¬éƒ¨ç½²åˆçº¦æˆ–è€…å‘èµ·äº¤æ˜“éƒ½å¯ä»¥é€šè¿‡GanacheæŸ¥çœ‹åˆ°ï¼Œå¦‚ä¸‹å›¾ï¼Œå±•ç¤ºçš„æ˜¯æˆ‘ä»¬éƒ¨ç½²åˆçº¦æ—¶å‘èµ·çš„äº¤æ˜“

![æˆªå›¾](a0c1ba00c9a6df512986c856af19e514.png)

åˆçº¦éƒ¨åˆ†å¤§æ¦‚å°±è¿™ä¹ˆå¤šï¼Œåé¢å°±æ˜¯ç¼–å†™åç«¯çš„ä»£ç ï¼Œé€‰æ‹©å¼€å‘è¯­è¨€å’Œæ•°æ®åº“
